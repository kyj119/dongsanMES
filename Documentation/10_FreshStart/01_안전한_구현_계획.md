# ì•ˆì „í•œ êµ¬í˜„ ê³„íš

## ğŸ¯ ëª©í‘œ
ê¸°ì¡´ ì‹œìŠ¤í…œì„ ê±´ë“œë¦¬ì§€ ì•Šê³ , ìƒˆë¡œìš´ ê¸°ëŠ¥ì„ ì•ˆì „í•˜ê²Œ ì¶”ê°€í•©ë‹ˆë‹¤.

---

## Phase 1: ë°ì´í„°ë² ì´ìŠ¤ í™•ì¥ (ê¸°ì¡´ í…Œì´ë¸”ì— ì»¬ëŸ¼ ì¶”ê°€ë§Œ)

### 1-1. Category í…Œì´ë¸” í™•ì¥
```csharp
// ê¸°ì¡´ ì»¬ëŸ¼ ìœ ì§€
public int Id { get; set; }
public string Name { get; set; }
public int CardOrder { get; set; }  // ê¸°ì¡´ ê·¸ëŒ€ë¡œ ìœ ì§€
public bool IsActive { get; set; }

// ìƒˆ ì»¬ëŸ¼ ì¶”ê°€
public int? ParentId { get; set; }  // ì†Œë¶„ë¥˜ìš© (nullì´ë©´ ëŒ€ë¶„ë¥˜)
public bool EnableMarginProcessing { get; set; } = false;  // ì—¬ë°± ì²˜ë¦¬ í™œì„±í™”
public bool EnableDomboMarkers { get; set; } = false;      // ë”ë³´ ë§ˆì»¤ í™œì„±í™”
```

### 1-2. PostProcessingConfig í…Œì´ë¸” ìƒì„± (ìƒˆ í…Œì´ë¸”)
```csharp
public class PostProcessingConfig
{
    public int Id { get; set; }
    public string Name { get; set; }              // ì›í˜•ë‚˜ë¬´, ë°´ë“œë¯¸ì‹±25 ë“±
    public string? Description { get; set; }
    
    // ì—¬ë°± ì„¤ì • (cm)
    public decimal MarginLeft { get; set; }
    public decimal MarginRight { get; set; }
    public decimal MarginTop { get; set; }
    public decimal MarginBottom { get; set; }
    
    // í…Œë‘ë¦¬ ì„¤ì •
    public bool AddTopBorder { get; set; }
    public bool AddBottomBorder { get; set; }
    public bool AddLeftBorder { get; set; }
    public bool AddRightBorder { get; set; }
    public decimal BorderWidth { get; set; } = 1.0m;  // mm
    
    // ì¶•ì†Œìœ¨
    public int ScalePercent { get; set; } = 20;  // ê¸°ë³¸ 20%
    
    // ë”ë³´ ë§ˆì»¤
    public bool AddDomboMarkers { get; set; }
    
    public bool IsActive { get; set; } = true;
    public int DisplayOrder { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.Now;
}
```

### 1-3. OrderItem í…Œì´ë¸” í™•ì¥
```csharp
// ê¸°ì¡´ ì»¬ëŸ¼ ëª¨ë‘ ìœ ì§€
public int Id { get; set; }
public int OrderId { get; set; }
public int ProductId { get; set; }
public string? Spec { get; set; }             // ê·¸ëŒ€ë¡œ ìœ ì§€
public string? Description { get; set; }      // ê·¸ëŒ€ë¡œ ìœ ì§€
public int Quantity { get; set; }
public decimal? UnitPrice { get; set; }
public string? DesignFileName { get; set; }   // ê·¸ëŒ€ë¡œ ìœ ì§€
public string? FilePath { get; set; }         // ê·¸ëŒ€ë¡œ ìœ ì§€
public string? Remark { get; set; }
public int LineNumber { get; set; }
public bool IsDeleted { get; set; }

// ìƒˆ ì»¬ëŸ¼ ì¶”ê°€
public int? PostProcessingConfigId { get; set; }  // í›„ê°€ê³µ ì„¤ì • ì°¸ì¡°
public bool AutoProcessEnabled { get; set; }      // ìë™ ì²˜ë¦¬ í™œì„±í™”
public bool ConvertToCMYK { get; set; }           // CMYK ë³€í™˜
public bool OutlineText { get; set; }             // ê¸€ì ì™¸ê³½ì„ 
public bool SplitArtboards { get; set; }          // ì•„íŠ¸ë³´ë“œ ë¶„ë¦¬

// ì²˜ë¦¬ ìƒíƒœ
public string ProcessStatus { get; set; } = "ëŒ€ê¸°";  // ëŒ€ê¸°, ì²˜ë¦¬ì¤‘, ì™„ë£Œ, ì˜¤ë¥˜
public string? ProcessJobId { get; set; }         // Job ID
public string? ProcessMessage { get; set; }       // ì²˜ë¦¬ ë©”ì‹œì§€
public DateTime? ProcessedAt { get; set; }        // ì²˜ë¦¬ ì™„ë£Œ ì‹œê°„
```

### 1-4. EF Core Migration
```bash
# ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±
dotnet ef migrations add AddPostProcessingSystem

# ë°ì´í„°ë² ì´ìŠ¤ ì—…ë°ì´íŠ¸
dotnet ef database update
```

### 1-5. ì´ˆê¸° ë°ì´í„° ì‹œë“œ (Program.cs ë˜ëŠ” ë³„ë„ Seed ìŠ¤í¬ë¦½íŠ¸)
```csharp
// 7ì¢… í›„ê°€ê³µ ì„¤ì • ì¶”ê°€
var postProcessingConfigs = new[]
{
    new PostProcessingConfig { Name = "ì›í˜•ë‚˜ë¬´", MarginLeft = 8, MarginRight = 8, AddTopBorder = true, ScalePercent = 20, DisplayOrder = 1 },
    new PostProcessingConfig { Name = "ë°´ë“œë¯¸ì‹±25", MarginLeft = 5, MarginRight = 5, MarginTop = 5, MarginBottom = 5, ScalePercent = 20, DisplayOrder = 2 },
    new PostProcessingConfig { Name = "ë°´ë“œë¯¸ì‹±40", MarginLeft = 4, MarginRight = 4, MarginTop = 4, MarginBottom = 4, ScalePercent = 20, DisplayOrder = 3 },
    new PostProcessingConfig { Name = "ë´‰ë¯¸ì‹±", MarginTop = 6, ScalePercent = 20, DisplayOrder = 4 },
    new PostProcessingConfig { Name = "ë‚˜ë¬´ë¯¸ì‹±", MarginLeft = 8, MarginRight = 8, ScalePercent = 20, DisplayOrder = 5 },
    new PostProcessingConfig { Name = "ê°ëª©", MarginTop = 8, MarginBottom = 8, ScalePercent = 20, DisplayOrder = 6 },
    new PostProcessingConfig { Name = "ì ‘ì–´ë¯¸ì‹±", MarginBottom = 5, ScalePercent = 20, DisplayOrder = 7 }
};
```

---

## Phase 2: ì£¼ë¬¸ ì…ë ¥ V2 í˜ì´ì§€ ìƒì„±

### 2-1. ìƒˆ í˜ì´ì§€ ìƒì„±
- `Pages/Admin/Orders/CreateV2.cshtml`
- `Pages/Admin/Orders/CreateV2.cshtml.cs`

### 2-2. í™”ë©´ êµ¬ì„±
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì£¼ë¬¸ì„œ ì‘ì„± (V2)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ê¸°ë³¸ ì •ë³´                                 â”‚
â”‚ - ê±°ë˜ì²˜, ë‹´ë‹¹ì, ë‚©ê¸°ì¼ ë“±               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ í’ˆëª© ì •ë³´                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ëŒ€ë¶„ë¥˜: [ë“œë¡­ë‹¤ìš´ â–¼]                 â”‚ â”‚
â”‚ â”‚ ì†Œë¶„ë¥˜: [ë“œë¡­ë‹¤ìš´ â–¼] (ëŒ€ë¶„ë¥˜ ì„ íƒì‹œ) â”‚ â”‚
â”‚ â”‚ í›„ê°€ê³µ: [ë“œë¡­ë‹¤ìš´ â–¼] (ì†Œë¶„ë¥˜ ì„ íƒì‹œ) â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                          â”‚
â”‚ íŒŒì¼ ì—…ë¡œë“œ                               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ [íŒŒì¼ ì„ íƒ] AI/EPS íŒŒì¼               â”‚ â”‚
â”‚ â”‚ â˜‘ ìë™ ì²˜ë¦¬                           â”‚ â”‚
â”‚ â”‚   â˜‘ CMYK ë³€í™˜                        â”‚ â”‚
â”‚ â”‚   â˜‘ ê¸€ì ì™¸ê³½ì„                        â”‚ â”‚
â”‚ â”‚   â˜‘ ì•„íŠ¸ë³´ë“œ ë¶„ë¦¬                     â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                          â”‚
â”‚ ê·œê²©/ìˆ˜ëŸ‰/ë‹¨ê°€                            â”‚
â”‚ [ì €ì¥] [ì·¨ì†Œ]                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2-3. JavaScript ë™ì  UI
```javascript
// ëŒ€ë¶„ë¥˜ ì„ íƒ â†’ ì†Œë¶„ë¥˜ ë¡œë“œ
$('#mainCategory').change(function() {
    const mainId = $(this).val();
    loadSubCategories(mainId);
});

// ì†Œë¶„ë¥˜ ì„ íƒ â†’ í›„ê°€ê³µ ì˜µì…˜ í‘œì‹œ
$('#subCategory').change(function() {
    const subId = $(this).val();
    loadPostProcessingOptions(subId);
});

// ìë™ ì²˜ë¦¬ ì²´í¬ â†’ ì˜µì…˜ í‘œì‹œ
$('#autoProcess').change(function() {
    $('#processOptions').toggle(this.checked);
});
```

---

## Phase 3: FileProcessorService V2 êµ¬í˜„

### 3-1. ìƒˆ ì„œë¹„ìŠ¤ í´ë˜ìŠ¤
- `Services/FileProcessorServiceV2.cs`

### 3-2. ì²˜ë¦¬ íë¦„
```
íŒŒì¼ ì—…ë¡œë“œ
    â†“
Job ID ìƒì„± (Guid)
    â†“
í´ë” êµ¬ì¡° ìƒì„±
/Designs/2026/02/20260205-01/
    â†“
Illustrator ìë™í™”
- ExtendScript ì‹¤í–‰
- ì—¬ë°± ì¶”ê°€
- í…Œë‘ë¦¬ ì¶”ê°€
- ì¶•ì†Œìœ¨ ì ìš©
- CMYK ë³€í™˜
- ê¸€ì ì™¸ê³½ì„ 
- ì•„íŠ¸ë³´ë“œ ë¶„ë¦¬
    â†“
PDF ì €ì¥
YYYYMMDD_ì£¼ë¬¸ë²ˆí˜¸_í’ˆëª©ë²ˆí˜¸_pageë²ˆí˜¸.pdf
    â†“
ìƒíƒœ ì—…ë°ì´íŠ¸
ProcessStatus = "ì™„ë£Œ"
```

### 3-3. ExtendScript í…œí”Œë¦¿
```javascript
// ì—¬ë°± ì¶”ê°€
var doc = app.activeDocument;
var margin = {
    left: 80,   // 8cm = 80mm
    right: 80,
    top: 0,
    bottom: 0
};

// ê¸°ì¡´ ì•„íŠ¸ì›Œí¬ ì´ë™
for (var i = 0; i < doc.pageItems.length; i++) {
    doc.pageItems[i].translate(margin.left * 2.834646, -margin.top * 2.834646);
}

// ì¶•ì†Œìœ¨ ì ìš©
var scale = 80;  // 20% ì¶•ì†Œ = 80%
for (var i = 0; i < doc.pageItems.length; i++) {
    doc.pageItems[i].resize(scale, scale);
}
```

---

## Phase 4: API ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„

### 4-1. ìƒˆ ì»¨íŠ¸ë¡¤ëŸ¬
- `Controllers/PostProcessingApiController.cs`

### 4-2. ì—”ë“œí¬ì¸íŠ¸
```csharp
// ì†Œë¶„ë¥˜ ëª©ë¡
GET /api/v2/categories/{mainId}/subcategories

// í›„ê°€ê³µ ì˜µì…˜
GET /api/v2/categories/{subId}/postprocessing

// íŒŒì¼ ì²˜ë¦¬
POST /api/v2/process/file
{
    "orderItemId": 123,
    "postProcessingConfigId": 1,
    "autoProcess": true,
    "cmyk": true,
    "outline": true,
    "split": true
}

// ì²˜ë¦¬ ìƒíƒœ í™•ì¸
GET /api/v2/process/status/{jobId}
```

---

## Phase 5: í†µí•© í…ŒìŠ¤íŠ¸

### 5-1. í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤
1. ëŒ€ë¶„ë¥˜ ì„ íƒ â†’ ì†Œë¶„ë¥˜ ë¡œë“œ í™•ì¸
2. ì†Œë¶„ë¥˜ ì„ íƒ â†’ í›„ê°€ê³µ ì˜µì…˜ í‘œì‹œ í™•ì¸
3. íŒŒì¼ ì—…ë¡œë“œ â†’ ìë™ ì²˜ë¦¬ ì‹¤í–‰
4. Illustrator ìë™í™” â†’ PDF ìƒì„± í™•ì¸
5. íŒŒì¼ëª… ê·œì¹™ â†’ Topaz RIP í˜¸í™˜ í™•ì¸

### 5-2. ë¡¤ë°± ê³„íš
- ê° Phaseë§ˆë‹¤ Git ì»¤ë°‹
- ë¬¸ì œ ë°œìƒ ì‹œ ì´ì „ ì»¤ë°‹ìœ¼ë¡œ ë¡¤ë°±
- ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ ë¡¤ë°± ê°€ëŠ¥

---

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

### Phase 1
- [ ] PostProcessingConfig ëª¨ë¸ ìƒì„±
- [ ] Category í™•ì¥ (ParentId ì¶”ê°€)
- [ ] OrderItem í™•ì¥ (PostProcessingConfigId ì¶”ê°€)
- [ ] EF Migration ìƒì„± ë° ì ìš©
- [ ] ì´ˆê¸° ë°ì´í„° ì‹œë“œ
- [ ] ë¹Œë“œ ì„±ê³µ í™•ì¸

### Phase 2
- [ ] CreateV2.cshtml ìƒì„±
- [ ] CreateV2.cshtml.cs ìƒì„±
- [ ] ë™ì  UI JavaScript êµ¬í˜„
- [ ] API ì—°ë™ í…ŒìŠ¤íŠ¸

### Phase 3
- [ ] FileProcessorServiceV2 ìƒì„±
- [ ] ExtendScript í…œí”Œë¦¿ ì‘ì„±
- [ ] Job ì²˜ë¦¬ ë¡œì§ êµ¬í˜„
- [ ] íŒŒì¼ëª… ê·œì¹™ ì ìš©

### Phase 4
- [ ] PostProcessingApiController ìƒì„±
- [ ] ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„
- [ ] API í…ŒìŠ¤íŠ¸

### Phase 5
- [ ] í†µí•© í…ŒìŠ¤íŠ¸
- [ ] ë¬¸ì„œí™”
- [ ] ë°°í¬ ì¤€ë¹„
