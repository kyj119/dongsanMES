# 현재 상태 분석 및 새로운 시작

## 📊 현재 시스템 상태 (커밋: 0f7d468)

### ✅ 안정적으로 작동하는 기능
1. **주문서 관리**: 작성, 수정, 삭제, 복구
2. **카드 관리**: 카드 생성, 상태 관리, 인쇄
3. **분류/품목 관리**: Category, Product CRUD
4. **현장 대시보드**: 작업 통계, 자동 새로고침
5. **Collector**: Topaz RIP 연동 (별도 프로그램)

### 📦 현재 데이터 모델

#### Category (분류)
```csharp
public class Category
{
    public int Id { get; set; }
    public string Name { get; set; }
    public int CardOrder { get; set; }  // 1=태극기, 2=현수막, 3=간판
    public bool IsActive { get; set; }
}
```

#### Product (품목)
```csharp
public class Product
{
    public int Id { get; set; }
    public int CategoryId { get; set; }
    public string Code { get; set; }
    public string Name { get; set; }
    public bool IsActive { get; set; }
}
```

#### OrderItem (주문 품목)
```csharp
public class OrderItem
{
    public int Id { get; set; }
    public int OrderId { get; set; }
    public int ProductId { get; set; }
    public string? Spec { get; set; }
    public string? Description { get; set; }
    public int Quantity { get; set; }
    public decimal? UnitPrice { get; set; }
    public string? DesignFileName { get; set; }
    public string? FilePath { get; set; }
    public int LineNumber { get; set; }
}
```

---

## 🎯 사용자 요구사항

### 1. 카드 분류 체계 (3단계 구조)
```
대분류 (CardOrder)
├─ 1. 태극기
├─ 2. 간판
│   ├─ 소분류
│   │   ├─ 현수막
│   │   ├─ 시트
│   │   └─ 후렉스
│   └─ 후가공 옵션
│       ├─ 여백 처리 활성화
│       └─ 돔보 마커 활성화
└─ 3. 출력
```

### 2. 후가공 타입 (7종)

| 후가공 타입 | 여백 (좌/우/상/하) | 테두리 | 축소율 |
|------------|------------------|-------|-------|
| 원형나무    | 8cm/8cm/0cm/0cm  | 상단 테두리 | 20% |
| 밴드미싱25  | 5cm/5cm/5cm/5cm  | 없음 | 20% |
| 밴드미싱40  | 4cm/4cm/4cm/4cm  | 없음 | 20% |
| 봉미싱     | 0cm/0cm/6cm/0cm  | 없음 | 20% |
| 나무미싱    | 8cm/8cm/0cm/0cm  | 없음 | 20% |
| 각목       | 0cm/0cm/8cm/8cm  | 없음 | 20% |
| 접어미싱    | 0cm/0cm/0cm/5cm  | 없음 | 20% |

### 3. 주문 입력 페이지 요구사항
- 대분류 → 소분류 → 후가공 선택 (3단계 드롭다운)
- AI/EPS 파일 업로드 + 자동 처리 옵션
- 여백/돔보/축소율 설정
- 파일 처리 후 Topaz RIP 호환 파일명 생성

### 4. 파일 처리 요구사항
- Illustrator 자동화 (ExtendScript)
- 여백 추가
- 테두리 추가 (선택적)
- 축소율 적용
- 출력 파일명: `YYYYMMDD_주문번호_품목번호_page번호.pdf`

---

## ⚠️ 이전 시도의 문제점

### 1. 데이터베이스 재설계 실패
- 기존 컬럼 이름 변경 (`Spec` → `Specification`)
- 전체 코드베이스 일괄 교체로 인한 부작용
- Deprecated 속성 추가로 경고 70개 발생

### 2. sed 스크립트 오남용
- 무분별한 일괄 교체
- 수정하지 말아야 할 곳까지 수정 (OrderItemInput, CardItem 등)
- 컴파일 오류 대량 발생

### 3. 롤백 실패
- Git 히스토리 꼬임
- 네트워크 경로 파일 커밋 문제

---

## ✅ 새로운 접근 방식

### 원칙 1: 기존 시스템 절대 건드리지 않기
- **기존 테이블 수정 금지**
- **기존 컬럼 이름 변경 금지**
- **기존 페이지 수정 최소화**

### 원칙 2: 새로운 기능은 새로운 코드로
- 새 테이블 추가만 허용
- 새 페이지 생성 (`CreateV2.cshtml`)
- 새 API 엔드포인트 (`/api/v2/process`)

### 원칙 3: 점진적 추가
- Phase별 독립적 구현
- 각 Phase마다 빌드 성공 확인
- 기존 기능 영향 없음 보장

---

## 🚀 다음 단계

지금부터 **안전하고 체계적인 방식**으로 새로운 기능을 추가하겠습니다.

**질문:**
1. 즉시 Phase 1 (데이터베이스 확장) 시작하시겠습니까?
2. 설계를 먼저 검토하시겠습니까?
3. 다른 접근 방식을 원하시나요?
