@page "{id:int}"
@model MESSystem.Pages.Admin.Orders.PrintModel
@{
    ViewData["Title"] = $"주문서 인쇄 - {Model.Order?.OrderNumber}";
    Layout = null;  // 인쇄용 레이아웃
}

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewData["Title"]</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @@media print {
            .no-print {
                display: none !important;
            }
            body {
                margin: 0;
                padding: 0;
            }
        }

        body {
            font-family: 'Malgun Gothic', sans-serif;
            font-size: 11pt;
        }

        .print-area {
            width: 210mm;
            min-height: 297mm;
            padding: 15mm;
            margin: 0 auto;
            background: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        .header-section {
            border: 3px solid #000;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
            background-color: #f8f9fa;
        }

        .header-section h1 {
            font-size: 32pt;
            font-weight: bold;
            margin: 0;
        }

        .order-number {
            font-size: 20pt;
            font-weight: bold;
            margin-top: 10px;
            color: #0d6efd;
        }

        .info-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .info-table th {
            background-color: #e9ecef;
            padding: 10px;
            text-align: left;
            border: 1px solid #000;
            width: 20%;
            font-weight: bold;
        }

        .info-table td {
            padding: 10px;
            border: 1px solid #000;
        }

        .items-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .items-table th {
            background-color: #212529;
            color: white;
            padding: 12px;
            text-align: center;
            border: 1px solid #000;
        }

        .items-table td {
            padding: 10px;
            border: 1px solid #000;
        }

        .items-table tfoot td {
            background-color: #f8f9fa;
            font-weight: bold;
            padding: 12px;
            border: 2px solid #000;
        }

        .total-section {
            float: right;
            width: 40%;
            margin-top: 20px;
        }

        .total-section table {
            width: 100%;
            border-collapse: collapse;
        }

        .total-section th {
            background-color: #e9ecef;
            padding: 10px;
            text-align: left;
            border: 1px solid #000;
        }

        .total-section td {
            padding: 10px;
            text-align: right;
            border: 1px solid #000;
            font-weight: bold;
        }

        .signature-section {
            clear: both;
            margin-top: 60px;
            padding-top: 30px;
            border-top: 2px solid #000;
        }

        .signature-box {
            text-align: center;
            padding: 20px;
            border: 1px solid #000;
            background-color: #fafafa;
        }

        .footer-section {
            margin-top: 40px;
            padding: 15px;
            border-top: 2px solid #000;
            font-size: 9pt;
            color: #666;
        }
    </style>
</head>
<body>
    @if (Model.Order == null)
    {
        <div class="container mt-5">
            <div class="alert alert-warning">
                <i class="fas fa-exclamation-triangle me-2"></i>
                주문서를 찾을 수 없습니다.
            </div>
        </div>
    }
    else
    {
        <!-- 인쇄 버튼 -->
        <div class="no-print text-center py-3">
            <button onclick="window.print()" class="btn btn-primary btn-lg me-2">
                <i class="fas fa-print me-2"></i> 인쇄
            </button>
            <button onclick="window.close()" class="btn btn-secondary btn-lg">
                <i class="fas fa-times me-2"></i> 닫기
            </button>
        </div>

        <!-- 인쇄 영역 -->
        <div class="print-area">
            <!-- 헤더 -->
            <div class="header-section">
                <h1>주 문 서</h1>
                <div class="order-number">주문번호: @Model.Order.OrderNumber</div>
                <small class="text-muted">
                    발행일: @Model.Order.CreatedAt.ToString("yyyy년 MM월 dd일")
                </small>
            </div>

            <!-- 거래처 정보 -->
            <h4 style="border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 15px;">
                <i class="fas fa-building me-2"></i>
                거래처 정보
            </h4>
            <table class="info-table">
                <tr>
                    <th><i class="fas fa-user me-2"></i>거래처명</th>
                    <td colspan="3"><strong style="font-size: 14pt;">@Model.Order.ClientName</strong></td>
                </tr>
                <tr>
                    <th><i class="fas fa-map-marker-alt me-2"></i>주소</th>
                    <td colspan="3">@(Model.Order.ClientAddress ?? "-")</td>
                </tr>
                <tr>
                    <th><i class="fas fa-phone me-2"></i>전화번호</th>
                    <td>@(Model.Order.ClientPhone ?? "-")</td>
                    <th><i class="fas fa-mobile-alt me-2"></i>휴대폰</th>
                    <td>@(Model.Order.ClientMobile ?? "-")</td>
                </tr>
            </table>

            <!-- 배송 정보 -->
            <h4 style="border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 15px; margin-top: 30px;">
                <i class="fas fa-shipping-fast me-2"></i>
                출고 정보
            </h4>
            <table class="info-table">
                <tr>
                    <th><i class="fas fa-calendar-alt me-2"></i>출고일시</th>
                    <td>
                        <strong>@Model.Order.ShippingDate.ToString("yyyy-MM-dd")</strong>
                        @if (Model.Order.ShippingTime.HasValue)
                        {
                            <span>(@Model.Order.ShippingTime.Value.ToString(@"hh\:mm"))</span>
                        }
                    </td>
                    <th><i class="fas fa-truck me-2"></i>출고방법</th>
                    <td><strong>@Model.Order.ShippingMethod</strong></td>
                </tr>
                @if (!string.IsNullOrEmpty(Model.Order.PaymentMethod))
                {
                    <tr>
                        <th><i class="fas fa-credit-card me-2"></i>결제방법</th>
                        <td colspan="3">@Model.Order.PaymentMethod</td>
                    </tr>
                }
            </table>

            <!-- 품목 목록 -->
            <h4 style="border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 15px; margin-top: 30px;">
                <i class="fas fa-box me-2"></i>
                품목 목록
            </h4>
            <table class="items-table">
                <thead>
                    <tr>
                        <th style="width: 5%">#</th>
                        <th style="width: 12%">품목코드</th>
                        <th style="width: 20%">품목명</th>
                        <th style="width: 8%">수량</th>
                        <th style="width: 15%">규격</th>
                        <th style="width: 10%">단가</th>
                        <th style="width: 10%">금액</th>
                        <th style="width: 20%">비고</th>
                    </tr>
                </thead>
                <tbody>
                    @{
                        decimal totalAmount = 0;
                        var orderedItems = Model.Order.OrderItems.OrderBy(oi => oi.LineNumber).ToList();
                    }
                    @foreach (var item in orderedItems)
                    {
                        var lineTotal = item.Quantity * (item.UnitPrice ?? 0);
                        totalAmount += lineTotal;
                        <tr>
                            <td class="text-center">@item.LineNumber</td>
                            <td>@item.Product.Code</td>
                            <td><strong>@item.Product.Name</strong></td>
                            <td class="text-end">@item.Quantity</td>
                            <td>@item.Spec</td>
                            <td class="text-end">@((item.UnitPrice ?? 0).ToString("N0"))원</td>
                            <td class="text-end"><strong>@lineTotal.ToString("N0")원</strong></td>
                            <td>@(item.Remark ?? "-")</td>
                        </tr>
                    }
                    @* 빈 줄 추가 (최소 5줄 보장) *@
                    @for (int i = orderedItems.Count + 1; i <= 5; i++)
                    {
                        <tr style="height: 40px;">
                            <td class="text-center">@i</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                        </tr>
                    }
                </tbody>
            </table>

            <!-- 합계 금액 -->
            <div class="total-section">
                <table>
                    <tr>
                        <th style="font-size: 12pt;">총 품목 수</th>
                        <td style="font-size: 12pt;">@(Model.Order.OrderItems.Count)개</td>
                    </tr>
                    <tr>
                        <th style="font-size: 12pt;">총 수량</th>
                        <td style="font-size: 12pt;">@Model.Order.OrderItems.Sum(oi => oi.Quantity)</td>
                    </tr>
                    <tr>
                        <th style="font-size: 14pt; background-color: #212529; color: white;">합계 금액</th>
                        <td style="font-size: 16pt; color: #dc3545;">
                            @totalAmount.ToString("N0") 원
                        </td>
                    </tr>
                </table>
            </div>

            <!-- 서명란 -->
            <div class="signature-section">
                <div class="row">
                    <div class="col-6">
                        <div class="signature-box">
                            <h5 class="mb-3">주문자</h5>
                            <div style="height: 60px;"></div>
                            <p class="mb-0">성명: _____________ (인)</p>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="signature-box">
                            <h5 class="mb-3">확인</h5>
                            <div style="height: 60px;"></div>
                            <p class="mb-0">성명: _____________ (인)</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 푸터 -->
            <div class="footer-section">
                <div class="row">
                    <div class="col-6">
                        <strong>발행처:</strong> MES 시스템<br>
                        <strong>문의:</strong> 내부 관리팀
                    </div>
                    <div class="col-6 text-end">
                        <small>
                            인쇄일시: @DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss")<br>
                            본 주문서는 MES 시스템에서 자동 생성되었습니다.
                        </small>
                    </div>
                </div>
            </div>
        </div>
    }
</body>
</html>
