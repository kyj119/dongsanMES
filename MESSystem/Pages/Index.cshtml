@page
@model MESSystem.Pages.IndexModel
@{
    ViewData["Title"] = "대시보드";
}

<div class="container-fluid mt-4">
    @if (Model.UserRole == "관리자")
    {
        <!-- 관리자 대시보드 -->
        <div class="row mb-4">
            <div class="col">
                <h2><i class="fas fa-chart-line me-2"></i>관리자 대시보드</h2>
                <p class="text-muted">전체 시스템 현황을 한눈에 확인하세요</p>
            </div>
        </div>

        <!-- 통계 카드 -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card bg-primary text-white">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="card-title mb-1">총 주문서</h6>
                                <h2 class="mb-0">@Model.TotalOrders</h2>
                            </div>
                            <div>
                                <i class="fas fa-file-invoice fa-3x opacity-50"></i>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer bg-transparent border-top border-white">
                        <a href="/Admin/Orders/Index" class="text-white text-decoration-none">
                            <small>전체 보기 <i class="fas fa-arrow-right"></i></small>
                        </a>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="card bg-success text-white">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="card-title mb-1">총 카드</h6>
                                <h2 class="mb-0">@Model.TotalCards</h2>
                            </div>
                            <div>
                                <i class="fas fa-id-card fa-3x opacity-50"></i>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer bg-transparent border-top border-white">
                        <a href="/Cards/Index" class="text-white text-decoration-none">
                            <small>전체 보기 <i class="fas fa-arrow-right"></i></small>
                        </a>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="card bg-warning text-white">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="card-title mb-1">진행중</h6>
                                <h2 class="mb-0">@Model.WorkingCards</h2>
                            </div>
                            <div>
                                <i class="fas fa-spinner fa-3x opacity-50"></i>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer bg-transparent border-top border-white">
                        <a href="/Cards/Index?status=작업중" class="text-white text-decoration-none">
                            <small>상세 보기 <i class="fas fa-arrow-right"></i></small>
                        </a>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="card bg-info text-white">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="card-title mb-1">대기중</h6>
                                <h2 class="mb-0">@Model.WaitingCards</h2>
                            </div>
                            <div>
                                <i class="fas fa-clock fa-3x opacity-50"></i>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer bg-transparent border-top border-white">
                        <a href="/Cards/Index?status=대기" class="text-white text-decoration-none">
                            <small>상세 보기 <i class="fas fa-arrow-right"></i></small>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- 최근 주문서 -->
        <div class="row">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header bg-light">
                        <h5 class="mb-0">
                            <i class="fas fa-list me-2"></i>
                            최근 주문서 (최근 10건)
                        </h5>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th>주문번호</th>
                                        <th>거래처</th>
                                        <th>출고일</th>
                                        <th>카드수</th>
                                        <th>상태</th>
                                        <th>작업</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @if (Model.RecentOrders.Any())
                                    {
                                        @foreach (var order in Model.RecentOrders)
                                        {
                                            <tr>
                                                <td><code>@order.OrderNumber</code></td>
                                                <td>@order.ClientName</td>
                                                <td>@order.ShippingDate.ToString("yyyy-MM-dd")</td>
                                                <td><span class="badge bg-info">@order.Cards.Count</span></td>
                                                <td>
                                                    @if (order.Status == "작성")
                                                    {
                                                        <span class="badge bg-secondary">작성</span>
                                                    }
                                                    else if (order.Status == "진행중")
                                                    {
                                                        <span class="badge bg-primary">진행중</span>
                                                    }
                                                    else if (order.Status == "완료")
                                                    {
                                                        <span class="badge bg-success">완료</span>
                                                    }
                                                </td>
                                                <td>
                                                    <a href="/Admin/Orders/Detail/@order.Id" class="btn btn-sm btn-outline-primary">
                                                        <i class="fas fa-eye"></i>
                                                    </a>
                                                </td>
                                            </tr>
                                        }
                                    }
                                    else
                                    {
                                        <tr>
                                            <td colspan="6" class="text-center text-muted py-4">
                                                최근 주문서가 없습니다.
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card">
                    <div class="card-header bg-light">
                        <h5 class="mb-0">
                            <i class="fas fa-chart-pie me-2"></i>
                            카드 상태 분포
                        </h5>
                    </div>
                    <div class="card-body">
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <span><i class="fas fa-circle text-warning me-2"></i>대기</span>
                                <span class="badge bg-warning text-dark rounded-pill">@Model.WaitingCards</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <span><i class="fas fa-circle text-primary me-2"></i>작업중</span>
                                <span class="badge bg-primary rounded-pill">@Model.WorkingCards</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <span><i class="fas fa-circle text-success me-2"></i>완료</span>
                                <span class="badge bg-success rounded-pill">@Model.CompletedCards</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <span><i class="fas fa-circle text-secondary me-2"></i>보류</span>
                                <span class="badge bg-secondary rounded-pill">@Model.HoldCards</span>
                            </li>
                        </ul>
                    </div>
                </div>

                <div class="card mt-3">
                    <div class="card-header bg-light">
                        <h5 class="mb-0">
                            <i class="fas fa-tools me-2"></i>
                            빠른 작업
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <a href="/Admin/Orders/Create" class="btn btn-primary">
                                <i class="fas fa-plus-circle me-2"></i>
                                주문서 작성
                            </a>
                            <a href="/Admin/Categories/Index" class="btn btn-outline-secondary">
                                <i class="fas fa-tags me-2"></i>
                                분류 관리
                            </a>
                            <a href="/Admin/Products/Index" class="btn btn-outline-secondary">
                                <i class="fas fa-box me-2"></i>
                                품목 관리
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }
    else
    {
        <!-- 현장 작업자 대시보드 -->
        <div class="row mb-4">
            <div class="col">
                <h2><i class="fas fa-clipboard-list me-2"></i>현장 작업 대시보드</h2>
                <p class="text-muted">오늘의 작업 현황을 확인하세요</p>
            </div>
        </div>

        <!-- 통계 카드 -->
        <div class="row mb-4">
            <div class="col-md-4">
                <div class="card bg-warning text-white">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="card-title mb-1">대기중</h6>
                                <h2 class="mb-0">@Model.WaitingCards</h2>
                            </div>
                            <div>
                                <i class="fas fa-clock fa-3x opacity-50"></i>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer bg-transparent border-top border-white">
                        <a href="/Cards/Index?status=대기" class="text-white text-decoration-none">
                            <small>상세 보기 <i class="fas fa-arrow-right"></i></small>
                        </a>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card bg-primary text-white">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="card-title mb-1">작업중</h6>
                                <h2 class="mb-0">@Model.WorkingCards</h2>
                            </div>
                            <div>
                                <i class="fas fa-spinner fa-3x opacity-50"></i>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer bg-transparent border-top border-white">
                        <a href="/Cards/Index?status=작업중" class="text-white text-decoration-none">
                            <small>상세 보기 <i class="fas fa-arrow-right"></i></small>
                        </a>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card bg-success text-white">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="card-title mb-1">완료</h6>
                                <h2 class="mb-0">@Model.CompletedCards</h2>
                            </div>
                            <div>
                                <i class="fas fa-check-circle fa-3x opacity-50"></i>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer bg-transparent border-top border-white">
                        <a href="/Cards/Index?status=완료" class="text-white text-decoration-none">
                            <small>상세 보기 <i class="fas fa-arrow-right"></i></small>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- 긴급 작업 목록 -->
        <div class="card">
            <div class="card-header bg-danger text-white">
                <h5 class="mb-0">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    긴급 작업 (오늘 출고)
                </h5>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>카드번호</th>
                                <th>분류</th>
                                <th>출고시간</th>
                                <th>상태</th>
                                <th>품목수</th>
                                <th>작업</th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (Model.UrgentCards.Any())
                            {
                                @foreach (var card in Model.UrgentCards)
                                {
                                    <tr>
                                        <td><strong>@card.CardNumber</strong></td>
                                        <td>@card.Category.Name</td>
                                        <td>
                                            @card.Order.ShippingDate.ToString("yyyy-MM-dd")
                                            @if (card.Order.ShippingTime.HasValue)
                                            {
                                                <span class="text-danger">
                                                    (@card.Order.ShippingTime.Value.ToString(@"hh\:mm"))
                                                </span>
                                            }
                                        </td>
                                        <td>
                                            @if (card.Status == "대기")
                                            {
                                                <span class="badge bg-warning text-dark">대기</span>
                                            }
                                            else if (card.Status == "작업중")
                                            {
                                                <span class="badge bg-primary">작업중</span>
                                            }
                                            else if (card.Status == "완료")
                                            {
                                                <span class="badge bg-success">완료</span>
                                            }
                                        </td>
                                        <td><span class="badge bg-info">@card.CardItems.Count</span></td>
                                        <td>
                                            <a href="/Cards/Detail/@card.Id" class="btn btn-sm btn-primary">
                                                <i class="fas fa-arrow-right"></i> 작업
                                            </a>
                                        </td>
                                    </tr>
                                }
                            }
                            else
                            {
                                <tr>
                                    <td colspan="6" class="text-center text-muted py-4">
                                        오늘 출고 예정인 긴급 작업이 없습니다.
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    }
</div>

@section Scripts {
    <script>
        // 자동 새로고침 (60초마다)
        setTimeout(function() {
            location.reload();
        }, 60000);
    </script>
}
