# ERP 매출/입금 관리 통합 가이드

## 📋 목차
1. [시스템 개요](#시스템-개요)
2. [작업 흐름](#작업-흐름)
3. [데이터베이스 설계](#데이터베이스-설계)
4. [핵심 기능](#핵심-기능)
5. [홈택스 연동](#홈택스-연동)
6. [구현 로드맵](#구현-로드맵)
7. [비용 분석](#비용-분석)

---

## 시스템 개요

### 🎯 목표

기존 MES 시스템에 **이카운트 방식**의 ERP 매출/입금 관리 기능을 추가하여 완전한 통합 시스템 구축

### ✨ 핵심 특징

1. **거래처별 기간 마감**: 월/주 단위로 주문서를 모아서 매출 확정
2. **유연한 조정**: 할인, 추가 비용, 카드 수수료 반영
3. **다양한 결제 방법**: 세금계산서, 카드결제, 현금영수증, 계좌이체
4. **홈택스 무료 연동**: ASP XML 파일 업로드 방식
5. **통장 자동 연동**: 오픈뱅킹 API (선택사항)

---

## 작업 흐름

### 📊 전체 프로세스

```
┌─────────────────────────────────────────────────────────────────┐
│                    1️⃣ MES 주문/생산 관리                         │
│                                                                  │
│  주문서 작성 → 생산 카드 생성 → 출력 작업 → 완료                 │
│                                                                  │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│                    2️⃣ ERP 매출 마감 (신규)                       │
│                                                                  │
│  Step 1: 마감 대상 조회                                          │
│  ├─ 거래처: (주)동산                                             │
│  ├─ 기간: 2026-02-01 ~ 2026-02-28                               │
│  └─ 완료된 주문서: 15건                                          │
│                                                                  │
│  Step 2: 매출 확인 및 조정 ✏️                                    │
│  ├─ 총 공급가액: 5,000,000원                                     │
│  ├─ 할인: -200,000원 (VIP 거래처 할인)                           │
│  ├─ 추가 비용: +50,000원 (추가 작업료)                           │
│  ├─ 조정 후: 4,850,000원                                         │
│  ├─ 부가세 (10%): 485,000원                                      │
│  └─ 합계: 5,335,000원                                            │
│                                                                  │
│  Step 3: 결제 방법 선택                                          │
│  ├─ ✅ 세금계산서 (일반)                                         │
│  ├─ □ 카드결제 (수수료 3% 별도)                                  │
│  ├─ □ 현금영수증                                                 │
│  └─ □ 계좌이체                                                   │
│                                                                  │
│  Step 4: 매출 확정 ✅                                            │
│  - 확정 버튼 클릭                                                │
│  - 주문서 상태: "완료" → "매출확정"                              │
│  - 매출 데이터 생성                                              │
│                                                                  │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│                 3️⃣ 세금계산서 발행 (홈택스)                     │
│                                                                  │
│  Step 1: XML 파일 생성                                           │
│  - MES 시스템에서 "세금계산서 XML 다운로드" 클릭                 │
│  - 파일명: 세금계산서_(주)동산_20260228.xml                     │
│                                                                  │
│  Step 2: 홈택스 업로드 👤                                        │
│  - 홈택스 접속 (https://www.hometax.go.kr)                      │
│  - 조회/발급 → 전자세금계산서 → 일괄발행                         │
│  - XML 파일 업로드                                               │
│  - 발행 완료 ✅                                                  │
│                                                                  │
│  Step 3: 승인번호 입력 (선택)                                    │
│  - 홈택스에서 발급된 승인번호 확인                               │
│  - MES 시스템에 승인번호 입력                                    │
│                                                                  │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│                    4️⃣ 입금 확인 💰                              │
│                                                                  │
│  방법 A: 수동 입금 등록                                          │
│  - 입금 일자 입력                                                │
│  - 입금액 입력                                                   │
│  - 매출 매칭                                                     │
│                                                                  │
│  방법 B: 통장 자동 연동 (오픈뱅킹)                               │
│  - 매일 자동으로 통장 거래내역 조회                              │
│  - AI 자동 매칭 (거래처명, 금액 기준)                            │
│  - 담당자 최종 확인                                              │
│                                                                  │
│  미수금 관리                                                     │
│  - 매출 5,335,000원                                              │
│  - 입금 5,335,000원                                              │
│  - 미수금 0원 ✅                                                 │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 데이터베이스 설계

### 📊 ERD (Entity Relationship Diagram)

```
┌──────────────┐
│   Client     │ 거래처
│──────────────│
│ Id           │
│ Name         │
│ BusinessNo   │◄────┐
│ CeoName      │     │
│ Address      │     │
│ ...          │     │
└──────────────┘     │
                     │
       ┌─────────────┼─────────────────────────┐
       │             │                         │
       │             │                         │
┌──────▼──────┐ ┌───▼──────────┐ ┌───────────▼────┐
│   Order     │ │SalesClosing  │ │   Payment       │
│─────────────│ │──────────────│ │────────────────│
│ Id          │ │ Id           │ │ Id             │
│ OrderNumber │ │ ClosingNo    │◄┤ SalesClosingId│
│ ClientId    ├─┤ ClientId     │ │ ClientId       │
│ IsSalesClosed│ │ StartDate    │ │ PaymentDate    │
│ ...         │ │ EndDate      │ │ Amount         │
└─────────────┘ │ SupplyAmount │ │ IsMatched      │
                │ DiscountAmt  │ │ ...            │
                │ TotalAmount  │ └────────────────┘
                │ PaymentType  │
                │ Status       │
                │ ...          │
                └──────┬───────┘
                       │
         ┌─────────────┼─────────────┐
         │             │             │
┌────────▼────────┐ ┌─▼────────────┐│
│SalesClosingItem│ │  TaxInvoice   ││
│────────────────│ │───────────────││
│ Id             │ │ Id            ││
│ SalesClosingId │ │ SalesClosingId││
│ OrderId        │ │ ApprovalNo    ││
│ OrderNumber    │ │ IssueDate     ││
│ SupplyAmount   │ │ Status        ││
│ ...            │ │ XmlFilePath   ││
└────────────────┘ │ ...           ││
                   └───┬───────────┘│
                       │            │
                ┌──────▼──────────┐ │
                │TaxInvoiceItem  │ │
                │────────────────│ │
                │ Id             │ │
                │ TaxInvoiceId   │◄┘
                │ ItemName       │
                │ Quantity       │
                │ SupplyAmount   │
                │ ...            │
                └────────────────┘
```

### 📋 테이블 목록

| 테이블 | 설명 | 주요 필드 |
|--------|------|-----------|
| **SalesClosing** | 매출 마감 헤더 | 마감번호, 거래처, 기간, 금액, 상태 |
| **SalesClosingItem** | 매출 마감 항목 | 주문서, 공급가액, 할인 |
| **TaxInvoice** | 세금계산서 | 승인번호, 발행일, 공급자/공급받는자 정보 |
| **TaxInvoiceItem** | 세금계산서 품목 | 품명, 수량, 단가, 공급가액 |
| **Payment** | 입금 | 입금일, 금액, 매칭 여부 |
| **BankTransaction** | 통장 거래 | 거래일시, 금액, 적요 |

---

## 핵심 기능

### 1️⃣ 매출 마감 프로세스

#### 화면 구성

```
┌─────────────────────────────────────────────────────────────┐
│  매출 마감 생성                                              │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  거래처: [ (주)동산 ▼ ]                                      │
│                                                              │
│  기간: [2026-02-01] ~ [2026-02-28]  [조회]                  │
│                                                              │
│  ┌────────────────────────────────────────────────────────┐ │
│  │ 미확정 주문서 (15건)                                    │ │
│  ├────────────────────────────────────────────────────────┤ │
│  │ ☑ 20260205-01  태극기 100매      1,000,000원          │ │
│  │ ☑ 20260207-02  현수막 5개        500,000원            │ │
│  │ ☑ 20260210-03  간판 2개          1,500,000원          │ │
│  │ ...                                                    │ │
│  │ ☑ 20260227-15  태극기 50매       500,000원            │ │
│  └────────────────────────────────────────────────────────┘ │
│                                                              │
│  총 공급가액:    5,000,000원                                 │
│                                                              │
│  ┌──────────────────────────────────────────┐              │
│  │ 조정 항목                                 │              │
│  ├──────────────────────────────────────────┤              │
│  │ 할인:     [ -200,000 ] 원  (VIP 할인)    │              │
│  │ 추가:     [  +50,000 ] 원  (추가 작업료) │              │
│  └──────────────────────────────────────────┘              │
│                                                              │
│  조정 후:        4,850,000원                                 │
│  부가세 (10%):     485,000원                                 │
│  ───────────────────────────────                            │
│  합계:           5,335,000원                                 │
│                                                              │
│  결제 방법:                                                  │
│  ○ 세금계산서  ○ 카드결제(수수료 3%)  ○ 현금영수증          │
│                                                              │
│  비고: [                                          ]          │
│                                                              │
│                         [임시저장]  [매출 확정]              │
└─────────────────────────────────────────────────────────────┘
```

#### 상태 흐름

```
임시저장 → 확정 → 세금계산서발행 → 입금완료
   ↓         ↓          ↓             ↓
 수정 가능  수정 불가   수정 불가     완료
```

---

### 2️⃣ 세금계산서 관리

#### 화면 구성

```
┌─────────────────────────────────────────────────────────────┐
│  세금계산서 목록                                             │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  [신규 작성]  [일괄 발행]                                    │
│                                                              │
│  ┌────┬────────┬────────┬──────────┬────────┬─────────┐    │
│  │선택│발행일  │거래처  │공급가액  │상태    │작업     │    │
│  ├────┼────────┼────────┼──────────┼────────┼─────────┤    │
│  │☑  │02/28   │(주)동산│4,850,000 │작성중  │[XML] [발행]│ │
│  │☑  │02/28   │OO무역  │3,200,000 │작성중  │[XML] [발행]│ │
│  │   │02/25   │XX상사  │1,500,000 │발행완료│[출력]   │    │
│  │   │02/20   │△△산업 │2,800,000 │발행완료│[출력]   │    │
│  └────┴────────┴────────┴──────────┴────────┴─────────┘    │
│                                                              │
│  선택 항목: 2건                                              │
│  [XML 일괄 다운로드]  [엑셀 내보내기]                        │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

#### XML 다운로드 흐름

```
세금계산서 목록 → [XML 다운로드] 클릭 → 파일 저장
   ↓
홈택스 접속 → 일괄발행 → XML 업로드 → 발행 완료
   ↓
승인번호 확인 → MES 시스템 입력 → 완료
```

---

### 3️⃣ 입금 관리

#### 화면 구성

```
┌─────────────────────────────────────────────────────────────┐
│  입금 내역                                                   │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  기간: [2026-02-01] ~ [2026-02-28]  [조회]                  │
│                                                              │
│  Tab: [전체] [미매칭] [매칭완료]                             │
│                                                              │
│  ┌────────┬────────┬──────────┬──────────┬────────────┐    │
│  │입금일  │거래처  │입금액    │매출      │상태        │    │
│  ├────────┼────────┼──────────┼──────────┼────────────┤    │
│  │02/28   │(주)동산│5,335,000 │SC-202602 │✅ 매칭완료 │    │
│  │02/27   │미확인  │1,000,000 │-         │❌ 미매칭   │ ◄─┐│
│  │02/25   │OO무역  │3,200,000 │SC-202601 │✅ 매칭완료 │  ││
│  └────────┴────────┴──────────┴──────────┴────────────┘  ││
│                                                            ││
│  [수동 입금 등록]  [통장 거래내역 불러오기]                ││
│                                                            ││
└────────────────────────────────────────────────────────────┘│
                                                              │
  클릭 ─────────────────────────────────────────────────────┘
  ↓
┌─────────────────────────────────────────────────────────────┐
│  입금 매칭                                                   │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  입금 정보:                                                  │
│  - 입금일: 2026-02-27                                        │
│  - 금액: 1,000,000원                                         │
│  - 입금자: 미확인                                            │
│                                                              │
│  매칭할 매출:                                                │
│  [ (주)동산 - SC-202602 - 5,335,000원 ▼ ]                   │
│                                                              │
│  또는 거래처 선택:                                           │
│  [ (주)동산 ▼ ]  (선입금 처리)                              │
│                                                              │
│                             [매칭 완료]  [취소]              │
└─────────────────────────────────────────────────────────────┘
```

---

### 4️⃣ 미수금 관리

#### 대시보드

```
┌─────────────────────────────────────────────────────────────┐
│  미수금 현황                                                 │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌──────────────┬──────────────┬──────────────┐            │
│  │ 총 매출      │ 총 입금      │ 총 미수금    │            │
│  ├──────────────┼──────────────┼──────────────┤            │
│  │ 50,000,000원 │ 45,000,000원 │ 5,000,000원  │            │
│  └──────────────┴──────────────┴──────────────┘            │
│                                                              │
│  거래처별 미수금 TOP 5                                       │
│  ┌────────────┬──────────────┬────────────┐                │
│  │ 거래처     │ 미수금       │ 기간       │                │
│  ├────────────┼──────────────┼────────────┤                │
│  │ (주)동산   │ 2,000,000원  │ 30일       │ ⚠️            │
│  │ OO무역     │ 1,500,000원  │ 15일       │                │
│  │ XX상사     │ 1,000,000원  │ 10일       │                │
│  │ △△산업    │   500,000원  │ 5일        │                │
│  └────────────┴──────────────┴────────────┘                │
│                                                              │
│  ⚠️ 30일 이상 미수금: 2건                                   │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

---

## 홈택스 연동

자세한 내용은 **[HOMETAX_INTEGRATION_GUIDE.md](./HOMETAX_INTEGRATION_GUIDE.md)** 참고

### 요약

1. **방식**: ASP XML 파일 업로드 (무료)
2. **장점**: 공인인증서 불필요, 구현 간단
3. **절차**:
   - MES에서 XML 다운로드
   - 홈택스 접속
   - 일괄발행 메뉴에서 업로드
   - 승인번호 확인 및 입력

---

## 구현 로드맵

### Phase 1: 데이터베이스 및 기본 기능 (2주)

**Week 1:**
- ✅ 데이터 모델 설계 완료
- ⏳ 데이터베이스 마이그레이션
- ⏳ Client 모델 확장 (사업자등록번호 등)

**Week 2:**
- ⏳ 매출 마감 생성 화면
- ⏳ 매출 조정 로직 (할인/추가)
- ⏳ 상태 관리 (임시저장/확정)

### Phase 2: 세금계산서 (1주)

**Week 3:**
- ⏳ XML 생성 서비스
- ⏳ 세금계산서 목록/상세 화면
- ⏳ XML 다운로드 기능
- ⏳ 승인번호 입력 화면

### Phase 3: 입금 관리 (1주)

**Week 4:**
- ⏳ 수동 입금 등록
- ⏳ 입금 매칭 화면
- ⏳ 미수금 대시보드

### Phase 4: 고급 기능 (선택, 2주)

**Week 5-6:**
- ⏳ 오픈뱅킹 API 연동
- ⏳ 자동 입금 매칭
- ⏳ 알림 기능 (미수금 알림)

---

## 비용 분석

### 초기 개발 비용

| 항목 | 예상 시간 | 비용 |
|------|----------|------|
| Phase 1 (기본 기능) | 2주 | 자체 개발 |
| Phase 2 (세금계산서) | 1주 | 자체 개발 |
| Phase 3 (입금 관리) | 1주 | 자체 개발 |
| **합계** | **4주** | **0원** |

### 월 운영 비용

| 항목 | 비용 | 필수 여부 |
|------|------|-----------|
| 홈택스 XML 업로드 | 무료 | 필수 |
| 오픈뱅킹 API | 건당 10~20원 (월 1~5만원) | 선택 |
| **합계** | **1~5만원** | |

### 대안 (유료 솔루션)

| 솔루션 | 월 비용 | 장점 | 단점 |
|--------|---------|------|------|
| 바로빌 | 3만원~ | 완전 자동화 | 비용 |
| 팝빌 | 건당 50원~ | 종량제 | 비용 |
| **자체 개발** | **1~5만원** | **저렴** | **개발 시간** |

---

## 다음 단계

### 지금 시작할 작업

1. ✅ 데이터 모델 완성 (완료)
2. ⏳ 데이터베이스 마이그레이션 실행
3. ⏳ Client 모델 업데이트 (화면 포함)
4. ⏳ 매출 마감 화면 개발
5. ⏳ XML 생성 서비스 개발

### 확인 필요 사항

- [ ] 거래처 사업자등록번호 데이터 확보
- [ ] 자사 세금계산서 발행 정보 (사업자등록번호, 대표자명 등)
- [ ] 홈택스 계정 (회계 담당자)
- [ ] 통장 연동 필요 여부 결정

---

**작성일**: 2026-02-11  
**작성자**: MES ERP 개발팀  
**버전**: 1.0

---

## 시작하시겠습니까?

다음 중 선택해주세요:

1. **지금 바로 구현 시작**: 데이터베이스 마이그레이션부터 실행
2. **추가 질문**: 더 알아보고 싶은 내용이 있으신가요?
3. **기능 수정**: 변경하고 싶은 부분이 있으신가요?
